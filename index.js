export function $c(tagName, attributes, children) {
    const el = document.createElement(tagName);

    if (attributes !== undefined) {
        for (const [attribute, value] of Object.entries(attributes)) {
            if (attribute === "textContent") {
                el.textContent = value;
            } else if (attribute === "innerHTML") {
                el.innerHTML = value;
            } else {
                el.setAttribute(attribute, value);
            }
        }
    }

    if (children !== undefined) {
        children.map((c) => {
            el.appendChild(c);
        });
    }

    return el;
}

export function $a(el, children) {
    children.map((child) => {
        el.appendChild(child);
    });
}

export function setupThemeButton() {
    const btn = document.getElementById("themeToggler");
    const prefersDarkScheme = window.matchMedia("(prefers-color-scheme: dark)");

    const darkText = "Dark";
    const lightText = "Light";

    const currentTheme = localStorage.getItem("theme");

    if (!currentTheme) {
        btn.textContent = document.body.classList.contains("light-theme")
            ? lightText
            : lightText;
    }

    if (currentTheme == "dark") {
        document.body.classList.toggle("dark-theme");
        btn.textContent = lightText;
    } else if (currentTheme == "light") {
        document.body.classList.toggle("light-theme");
        btn.textContent = darkText;
    }

    btn.addEventListener("click", function () {
        if (btn.innerText == lightText) {
            btn.innerText = darkText;
        } else {
            btn.innerText = lightText;
        }

        if (prefersDarkScheme.matches) {
            document.body.classList.toggle("light-theme");
            var theme = document.body.classList.contains("light-theme")
                ? "light"
                : "dark";
        } else {
            document.body.classList.toggle("dark-theme");
            var theme = document.body.classList.contains("dark-theme")
                ? "dark"
                : "light";
        }
        localStorage.setItem("theme", theme);
    });
}

export function setupNav() {
    document
        .querySelector("nav")
        .querySelectorAll("a")
        .forEach((el) => {
            if (el.href == window.location.href) {
                el.classList.add("active");
            }
        });
}

const header = document.querySelector("header");
const footer = document.querySelector("footer");

const urls = {
    email: "mailto:safe.key1974@fastmail.com",
    github: "https://github.com/manskron",
    linkedin: "https://www.linkedin.com/in/mansbrusback/",
};

const pages = {
    home: "/",
    cells: "/pages/cells.html",
    emacsConf: "/pages/emacsconf.html",
};

const logo = `
<svg viewBox="0 0 204 164" fill="none"
    xmlns="http://www.w3.org/2000/svg">
    <path id="semicircle" d="M27.5806 75.8558C27.6557 40.0793 52.1918 9.73115 86.9277 1.83995C105.337 -2.34403 125.406 0.670812 141.711 10.2396C165.165 24.0022 179.46 48.4987 179.527 75.8083C179.527 75.9151 179.474 75.9685 179.369 75.9685H27.6933C27.6634 75.9685 27.6347 75.9566 27.6136 75.9355C27.5924 75.9144 27.5806 75.8857 27.5806 75.8558Z" fill="#4A68D9"/>
    <rect class="line" x="27.5884" y="131.755" width="151.929" height="2.37389" rx="1" fill="#4A68D9"/>
    <rect class="line" x="27.5884" y="85.4641" width="151.929" height="4.74777" rx="1" fill="#4A68D9"/>
    <rect class="line" x="27.5884" y="78.3424" width="151.929" height="4.74777" rx="1" fill="#4A68D9"/>
    <path class="text" d="M12.122 124.456C11.362 124.456 10.6653 124.367 10.032 124.19C9.424 124.038 8.87933 123.835 8.398 123.582C7.942 123.303 7.54933 123.012 7.22 122.708C6.916 122.379 6.688 122.075 6.536 121.796H6.384V124H1.976V116.248H6.384V117.882C6.384 119.25 6.86533 120.225 7.828 120.808C8.79067 121.365 10.108 121.644 11.78 121.644C13.528 121.644 14.82 121.289 15.656 120.58C16.5173 119.871 16.948 118.946 16.948 117.806C16.948 117.249 16.872 116.767 16.72 116.362C16.5933 115.957 16.3653 115.615 16.036 115.336C15.7067 115.032 15.2633 114.779 14.706 114.576C14.1487 114.348 13.452 114.145 12.616 113.968L10.906 113.588C9.614 113.335 8.42333 112.993 7.334 112.562C6.27 112.106 5.358 111.523 4.598 110.814C3.838 110.105 3.24267 109.256 2.812 108.268C2.40667 107.28 2.204 106.115 2.204 104.772C2.204 103.632 2.40667 102.593 2.812 101.656C3.21733 100.693 3.8 99.87 4.56 99.186C5.32 98.502 6.25733 97.97 7.372 97.59C8.512 97.21 9.804 97.02 11.248 97.02C12.0333 97.02 12.73 97.1087 13.338 97.286C13.9713 97.438 14.516 97.6407 14.972 97.894C15.4533 98.1473 15.846 98.4387 16.15 98.768C16.454 99.072 16.682 99.3633 16.834 99.642H16.986V97.476H21.394V105.228H16.986V103.556C16.986 102.213 16.5173 101.263 15.58 100.706C14.6427 100.123 13.4267 99.832 11.932 99.832C10.2093 99.832 8.94267 100.199 8.132 100.934C7.34667 101.643 6.954 102.505 6.954 103.518C6.954 104.101 7.04267 104.595 7.22 105C7.39733 105.405 7.676 105.76 8.056 106.064C8.46133 106.368 8.98067 106.634 9.614 106.862C10.2473 107.065 11.02 107.267 11.932 107.47L13.528 107.774C14.8453 108.053 16.0233 108.42 17.062 108.876C18.126 109.307 19.0127 109.864 19.722 110.548C20.4567 111.232 21.014 112.043 21.394 112.98C21.774 113.892 21.964 114.956 21.964 116.172C21.964 117.363 21.736 118.465 21.28 119.478C20.824 120.491 20.1653 121.365 19.304 122.1C18.468 122.835 17.442 123.417 16.226 123.848C15.01 124.253 13.642 124.456 12.122 124.456ZM23.6883 121.492H25.5883L33.8343 97.476H39.0783L47.3243 121.492H49.2243V124H38.0903V121.492H41.1303L39.3063 115.906H30.6423L28.8183 121.492H31.8583V124H23.6883V121.492ZM31.4023 113.284H38.6223L35.0503 102.112H34.8983L31.4023 113.284ZM51.2846 121.492H53.9446V99.984H51.2846V97.476H61.5446L72.4126 116.362H72.6406V99.984H69.9806V97.476H78.2266V99.984H75.6046V124H70.0566L57.1366 101.922H56.9086V121.492H59.5686V124H51.2846V121.492ZM81.3432 121.492H84.0032V99.984H81.3432V97.476H93.7312C95.5552 97.476 97.2398 97.78 98.7852 98.388C100.356 98.9707 101.711 99.832 102.851 100.972C103.991 102.087 104.878 103.467 105.511 105.114C106.17 106.761 106.499 108.635 106.499 110.738C106.499 112.841 106.17 114.715 105.511 116.362C104.878 118.009 103.991 119.402 102.851 120.542C101.711 121.657 100.356 122.518 98.7852 123.126C97.2398 123.709 95.5552 124 93.7312 124H81.3432V121.492ZM90.1592 121.264H92.6292C93.8958 121.264 94.9725 121.137 95.8592 120.884C96.7712 120.631 97.5058 120.238 98.0632 119.706C98.6458 119.149 99.0638 118.427 99.3172 117.54C99.5958 116.628 99.7352 115.526 99.7352 114.234V107.242C99.7352 105.95 99.5958 104.861 99.3172 103.974C99.0638 103.062 98.6458 102.34 98.0632 101.808C97.5058 101.251 96.7712 100.845 95.8592 100.592C94.9725 100.339 93.8958 100.212 92.6292 100.212H90.1592V121.264ZM107.852 121.492H109.752L117.998 97.476H123.242L131.488 121.492H133.388V124H122.254V121.492H125.294L123.47 115.906H114.806L112.982 121.492H116.022V124H107.852V121.492ZM115.566 113.284H122.786L119.214 102.112H119.062L115.566 113.284ZM146.534 124.456C144.634 124.456 142.95 124.114 141.48 123.43C140.036 122.721 138.808 121.758 137.794 120.542C136.781 119.301 136.008 117.844 135.476 116.172C134.97 114.5 134.716 112.701 134.716 110.776C134.716 108.547 135.02 106.571 135.628 104.848C136.262 103.125 137.098 101.694 138.136 100.554C139.175 99.3887 140.378 98.5147 141.746 97.932C143.14 97.324 144.584 97.02 146.078 97.02C146.889 97.02 147.598 97.1087 148.206 97.286C148.84 97.438 149.384 97.6407 149.84 97.894C150.296 98.1473 150.676 98.4387 150.98 98.768C151.284 99.072 151.512 99.376 151.664 99.68H151.892V97.476H156.3V105.912H151.892V104.202C151.892 102.91 151.462 101.871 150.6 101.086C149.764 100.301 148.536 99.908 146.914 99.908C145.217 99.908 143.887 100.44 142.924 101.504C141.962 102.568 141.48 104.24 141.48 106.52V114.234C141.48 115.425 141.632 116.438 141.936 117.274C142.24 118.11 142.658 118.807 143.19 119.364C143.748 119.921 144.394 120.327 145.128 120.58C145.888 120.833 146.712 120.96 147.598 120.96C149.22 120.96 150.588 120.542 151.702 119.706C152.842 118.845 153.704 117.692 154.286 116.248L156.452 117.502C156.123 118.465 155.654 119.377 155.046 120.238C154.438 121.074 153.704 121.809 152.842 122.442C152.006 123.075 151.056 123.569 149.992 123.924C148.928 124.279 147.776 124.456 146.534 124.456ZM159.57 121.492H162.23V99.984H159.57V97.476H171.046V99.984H168.386V108.99H178.494V99.984H175.834V97.476H187.31V99.984H184.65V121.492H187.31V124H175.834V121.492H178.494V111.726H168.386V121.492H171.046V124H159.57V121.492ZM190.408 121.492H193.068V99.984H190.408V97.476H201.884V99.984H199.224V121.492H201.884V124H190.408V121.492Z" fill="#464555"/>
    <path class="text" d="M82.866 158.276C81.854 158.276 80.934 158.084 80.106 157.701C79.278 157.318 78.5727 156.766 77.99 156.045C77.4073 155.324 76.955 154.45 76.633 153.423C76.311 152.396 76.15 151.246 76.15 149.973C76.15 148.639 76.311 147.458 76.633 146.431C76.955 145.404 77.3997 144.537 77.967 143.832C78.5497 143.127 79.2473 142.59 80.06 142.222C80.8727 141.854 81.7697 141.67 82.751 141.67C83.7477 141.67 84.5757 141.839 85.235 142.176C85.9097 142.498 86.3543 142.904 86.569 143.395H86.661V141.946H88.317V146.638H86.661V145.442C86.661 144.675 86.3237 144.062 85.649 143.602C84.9743 143.127 84.0927 142.889 83.004 142.889C82.1913 142.889 81.486 143.042 80.888 143.349C80.3053 143.64 79.8223 144.047 79.439 144.568C79.071 145.074 78.795 145.672 78.611 146.362C78.4423 147.037 78.358 147.75 78.358 148.501V151.284C78.358 152.127 78.4653 152.886 78.68 153.561C78.91 154.236 79.232 154.818 79.646 155.309C80.0753 155.784 80.5967 156.152 81.21 156.413C81.8233 156.674 82.521 156.804 83.303 156.804C84.3917 156.804 85.304 156.52 86.04 155.953C86.776 155.386 87.3127 154.665 87.65 153.791L88.547 154.228C88.409 154.673 88.1867 155.133 87.88 155.608C87.5733 156.083 87.1823 156.52 86.707 156.919C86.247 157.318 85.695 157.647 85.051 157.908C84.407 158.153 83.6787 158.276 82.866 158.276ZM96.1979 157.149C96.7652 157.149 97.2559 157.057 97.6699 156.873C98.0992 156.674 98.4442 156.405 98.7049 156.068C98.9809 155.715 99.1802 155.309 99.3029 154.849C99.4409 154.374 99.5099 153.86 99.5099 153.308V150.824C99.5099 150.272 99.4409 149.766 99.3029 149.306C99.1802 148.831 98.9809 148.424 98.7049 148.087C98.4442 147.734 98.0992 147.466 97.6699 147.282C97.2559 147.083 96.7652 146.983 96.1979 146.983C95.6152 146.983 95.1169 147.083 94.7029 147.282C94.2889 147.466 93.9439 147.734 93.6679 148.087C93.4072 148.424 93.2079 148.831 93.0699 149.306C92.9472 149.766 92.8859 150.272 92.8859 150.824V153.308C92.8859 153.86 92.9472 154.374 93.0699 154.849C93.2079 155.309 93.4072 155.715 93.6679 156.068C93.9439 156.405 94.2889 156.674 94.7029 156.873C95.1169 157.057 95.6152 157.149 96.1979 157.149ZM96.1979 158.276C95.3852 158.276 94.6416 158.13 93.9669 157.839C93.2922 157.548 92.7172 157.134 92.2419 156.597C91.7666 156.045 91.3986 155.393 91.1379 154.642C90.8772 153.875 90.7469 153.017 90.7469 152.066C90.7469 151.131 90.8772 150.28 91.1379 149.513C91.3986 148.746 91.7666 148.095 92.2419 147.558C92.7172 147.006 93.2922 146.584 93.9669 146.293C94.6416 146.002 95.3852 145.856 96.1979 145.856C97.0106 145.856 97.7542 146.002 98.4289 146.293C99.1036 146.584 99.6786 147.006 100.154 147.558C100.629 148.095 100.997 148.746 101.258 149.513C101.519 150.28 101.649 151.131 101.649 152.066C101.649 153.017 101.519 153.875 101.258 154.642C100.997 155.393 100.629 156.045 100.154 156.597C99.6786 157.134 99.1036 157.548 98.4289 157.839C97.7542 158.13 97.0106 158.276 96.1979 158.276ZM103.844 156.942H105.546V147.627L103.844 147.328V146.546L107.386 145.856V147.926H107.501C107.609 147.681 107.739 147.435 107.892 147.19C108.061 146.945 108.26 146.722 108.49 146.523C108.736 146.324 109.012 146.163 109.318 146.04C109.64 145.917 110.008 145.856 110.422 145.856C111.097 145.856 111.634 146.017 112.032 146.339C112.446 146.661 112.653 147.129 112.653 147.742C112.653 148.202 112.538 148.562 112.308 148.823C112.078 149.084 111.779 149.214 111.411 149.214C110.997 149.214 110.668 149.107 110.422 148.892C110.177 148.662 110.054 148.371 110.054 148.018C110.054 147.711 110.116 147.466 110.238 147.282C110.376 147.083 110.53 146.968 110.698 146.937V146.891C110.637 146.876 110.56 146.868 110.468 146.868C110.376 146.853 110.261 146.845 110.123 146.845C109.801 146.845 109.479 146.929 109.157 147.098C108.835 147.251 108.544 147.458 108.283 147.719C108.038 147.964 107.831 148.248 107.662 148.57C107.509 148.892 107.432 149.214 107.432 149.536V156.942H109.594V158H103.844V156.942ZM113.812 161.542H115.514V147.627L113.812 147.328V146.546L117.4 145.856V147.926H117.492C117.752 147.359 118.166 146.876 118.734 146.477C119.301 146.063 120.052 145.856 120.988 145.856C122.46 145.856 123.633 146.393 124.507 147.466C125.396 148.524 125.841 150.057 125.841 152.066C125.841 154.075 125.396 155.616 124.507 156.689C123.633 157.747 122.46 158.276 120.988 158.276C120.068 158.276 119.316 158.077 118.734 157.678C118.166 157.279 117.752 156.796 117.492 156.229H117.4V161.542H119.562V162.6H113.812V161.542ZM120.436 156.965C121.494 156.965 122.314 156.612 122.897 155.907C123.495 155.186 123.794 154.228 123.794 153.032V151.1C123.794 149.904 123.495 148.953 122.897 148.248C122.314 147.527 121.494 147.167 120.436 147.167C120.068 147.167 119.7 147.221 119.332 147.328C118.964 147.435 118.634 147.589 118.343 147.788C118.067 147.987 117.837 148.24 117.653 148.547C117.484 148.838 117.4 149.168 117.4 149.536V154.596C117.4 154.964 117.484 155.301 117.653 155.608C117.837 155.899 118.067 156.145 118.343 156.344C118.634 156.543 118.964 156.697 119.332 156.804C119.7 156.911 120.068 156.965 120.436 156.965ZM129.383 158.276C128.938 158.276 128.585 158.146 128.325 157.885C128.079 157.609 127.957 157.279 127.957 156.896V156.758C127.957 156.375 128.079 156.053 128.325 155.792C128.585 155.516 128.938 155.378 129.383 155.378C129.827 155.378 130.172 155.516 130.418 155.792C130.678 156.053 130.809 156.375 130.809 156.758V156.896C130.809 157.279 130.678 157.609 130.418 157.885C130.172 158.146 129.827 158.276 129.383 158.276Z" fill="#464555"/>
</svg>
`;

$a(header, [
    $c("a", {
        id: "logo-link",
        href: "/",
        "aria-label": "Go to startpage",
        innerHTML: logo,
    }),
    $c("nav", undefined, [
        $c("a", { href: pages.home, textContent: "Home" }),
        $c("a", { href: pages.cells, textContent: "Cells" }),
        $c("a", { href: pages.emacsConf, textContent: "Emacs config" }),
        $c("button", {
            type: "button",
            id: "themeToggler",
        }),
    ]),
]);

$a(footer, [
    $c("div", { id: "footer-links" }, [
        $c("a", { href: urls.email, textContent: "Email" }),
        $c("a", { href: urls.github, textContent: "Github" }),
        $c("a", { href: urls.linkedin, textContent: "LinkedIn" }),
    ]),
    $c("div", { id: "footer-copyline" }, [
        $c("i", { textContent: "© 1978 SANDACHI Corporation" }),
    ]),
]);

setupNav();
setupThemeButton();
